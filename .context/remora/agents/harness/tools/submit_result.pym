from grail import Input, external


@external
async def submit_result(summary: str, changed_files: list[str]) -> bool:
    ...

node_text_input: str | None = Input("node_text_input", default=None)
node_text: str | None = Input("node_text", default=None)
target_file_input: str | None = Input("target_file_input", default=None)
target_file: str | None = Input("target_file", default=None)
workspace_id: str | None = Input("workspace_id", default=None)

summary: str = Input("summary")
changed_files: list[str] = Input("changed_files")

workspace_value = workspace_id or "unknown"

try:
    normalized_files = [str(path) for path in changed_files]
    await submit_result(str(summary), normalized_files)
    result = {
        "status": "success",
        "workspace_id": workspace_value,
        "changed_files": normalized_files,
        "summary": str(summary),
        "details": {},
        "error": None,
    }
except Exception as exc:
    result = {
        "status": "failed",
        "workspace_id": workspace_value,
        "changed_files": [],
        "summary": "",
        "details": {},
        "error": str(exc),
    }

result
